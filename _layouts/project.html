---
layout: archive
---

{% assign pdata = site.data[page.project_key] %}
<link rel="stylesheet" href="{{ '/assets/css/project.css' | relative_url }}">

{% assign EMPTY = "" | split: "" %}

<section class="project-hero">
  <div class="project-header">
    {% if pdata.logos and pdata.logos.project %}
      <div class="project-header__logo">
        <img class="project-logo-fixed-h" src="{{ pdata.logos.project | relative_url }}" alt="Project logo">
      </div>
    {% endif %}

    <div class="project-header__names" aria-label="Project name">
      <div class="name-blocks">
        {% if pdata.acronym %}
          <span class="name-block name-block--acronym">{{ pdata.acronym }}</span>
        {% endif %}
        <span class="name-block name-block--title">{{ pdata.title | default: page.title }}</span>
      </div>
    </div>
  </div>

  <div class="project-hero__meta">
    {% if pdata.period %}
    <div class="meta-item">
      <span class="meta-label">Period</span>
      <span class="meta-value">{{ pdata.period }}</span>
    </div>
    {% endif %}

    {% if pdata.role %}
    <div class="meta-item">
      <span class="meta-label">Role</span>
      <span class="meta-value">{{ pdata.role }}</span>
    </div>
    {% endif %}

    {% if pdata.budget %}
    <div class="meta-item">
      <span class="meta-label">Budget</span>
      <span class="meta-value">{{ pdata.budget }}</span>
    </div>
    {% endif %}

    {% if pdata.funding %}
    <div class="meta-item">
      <span class="meta-label">Funding</span>
      <span class="meta-value">
        {% if pdata.funding.url %}
          <a href="{{ pdata.funding.url }}" target="_blank" rel="noopener">{{ pdata.funding.text | default: pdata.funding.url }}</a>
        {% else %}
          {{ pdata.funding | markdownify | strip_newlines | replace: '<p>', '' | replace: '</p>', '' }}
        {% endif %}
      </span>
    </div>
    {% endif %}
  </div>
</section>

<section class="project-description">
  <h2>Description</h2>
  <p>{{ pdata.description }}</p>
</section>

{% comment %}
PEOPLE: prefer pdata.people; otherwise filter from _data/team by page.project_key.
{% endcomment %}
{% assign people_final = EMPTY %}

{% if pdata.people and pdata.people.size > 0 %}
  {% assign people_final = pdata.people %}
{% else %}
  {% assign project_key = page.project_key %}
  {% assign team_data = site.data.team | default: site.data.team_yaml | default: EMPTY %}
  {% assign current_team_all = team_data.current_team | default: EMPTY %}
  {% assign visiting_all = team_data.visiting_members | default: EMPTY %}
  {% assign past_all = team_data.past_members | default: EMPTY %}

  {% assign cur_has_projects = current_team_all | where_exp: "m", "m.projects" %}
  {% assign cur_filtered = cur_has_projects | where_exp: "m", "m.projects contains project_key" %}

  {% assign vis_has_projects = visiting_all | where_exp: "m", "m.projects" %}
  {% assign vis_filtered = vis_has_projects | where_exp: "m", "m.projects contains project_key" %}

  {% assign people_final = cur_filtered | concat: vis_filtered %}

  {% if pdata.include_past_team == true %}
    {% assign past_has_projects = past_all | where_exp: "m", "m.projects" %}
    {% assign past_filtered = past_has_projects | where_exp: "m", "m.projects contains project_key" %}
    {% assign people_final = people_final | concat: past_filtered %}
  {% endif %}
{% endif %}

{% if people_final and people_final.size > 0 %}
<section class="project-people">
  <h2>People</h2>
  <div class="people-grid">
    {% for person in people_final %}
    <article class="person-card">
      {% if person.photo %}
        <img class="person-photo" src="{{ person.photo | relative_url }}" alt="{{ person.name }}">
      {% endif %}
      <div class="person-content">
        <h3 class="person-name">
          {% if person.website %}
            <a href="{{ person.website }}" target="_blank" rel="noopener">{{ person.name }}</a>
          {% else %}
            {{ person.name }}
          {% endif %}
        </h3>

        {% if person.role %}
          <p class="person-role">{{ person.role }}</p>
        {% endif %}

        {% if person.affiliation %}
          <p class="person-affiliation">{{ person.affiliation }}</p>
        {% endif %}

          {% if person.roles and person.roles.size > 0 %}
            {% assign latest_role = person.roles[0] %}
            {% if latest_role.category %}
              <p class="person-role">{{ latest_role.category }}</p>
            {% endif %}
          {% endif %}


        <ul class="person-links">
          {% if person.email %}<li><a href="mailto:{{ person.email }}">Email</a></li>{% endif %}
          {% if person.linkedin %}<li><a href="{{ person.linkedin }}" target="_blank" rel="noopener">LinkedIn</a></li>{% endif %}
          {% if person.socials %}
            {% for s in person.socials %}
              <li><a href="{{ s.url }}" target="_blank" rel="noopener">{{ s.label }}</a></li>
            {% endfor %}
          {% endif %}
        </ul>
      </div>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}

{% comment %}
NEWS from YAML only (pdata.project_news)
{% endcomment %}
{% assign yaml_news = pdata.project_news | default: EMPTY %}
{% if yaml_news and yaml_news.size > 0 %}
  {% assign news_sorted = yaml_news | sort: "date" | reverse %}
<section class="project-news">
  <h2>Project news</h2>
  <div class="news-grid">
    {% for item in news_sorted %}
      <article class="news-card">
        <h3 class="news-title">
          {% if item.url %}
            <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
          {% else %}
            {{ item.title }}
          {% endif %}
        </h3>
        <div class="news-meta">
          {% if item.date %}
            <time datetime="{{ item.date }}">{{ item.date | date: '%b %d, %Y' }}</time>
          {% endif %}
        </div>
        {% if item.excerpt %}
          <p class="news-excerpt">{{ item.excerpt }}</p>
        {% endif %}
      </article>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if pdata.videos and pdata.videos.size > 0 %}
<section class="project-videos">
  <h2>Videos</h2>
  <div class="videos-grid">
    {% for v in pdata.videos %}
      <div class="video-card">
        {% assign yt = v.url | downcase %}
        {% if yt contains "youtube.com" or yt contains "youtu.be" %}
          {% assign id = v.url
            | replace: 'https://youtu.be/', ''
            | replace: 'http://youtu.be/', ''
            | replace: 'https://www.youtube.com/watch?v=', ''
            | replace: 'http://www.youtube.com/watch?v=', ''
            | split: '&' | first %}
          <div class="video-embed">
            <iframe
              src="https://www.youtube.com/embed/{{ id }}"
              title="{{ v.title | escape }}"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen></iframe>
          </div>
        {% else %}
          <p><a href="{{ v.url }}" target="_blank" rel="noopener">{{ v.title }}</a></p>
        {% endif %}
        <p class="video-title">{{ v.title }}</p>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{% comment %}
PUBLICATIONS: prefer _publications filtered by key; fallback to YAML list.
{% endcomment %}
{% assign pkey = pdata.publications_key | default: page.project_key %}
{% assign pubs_collection = site.publications | default: EMPTY %}

{% assign pubs_with_projects = pubs_collection | where_exp: "p", "p.projects" %}
{% assign pubs_by_projects = pubs_with_projects | where_exp: "p", "p.projects contains pkey" %}

{% assign pubs_with_tags = pubs_collection | where_exp: "p", "p.tags" %}
{% assign pubs_by_tags = pubs_with_tags | where_exp: "p", "p.tags contains pkey" %}

{% assign pubs = pubs_by_projects | concat: pubs_by_tags | uniq | sort: 'date' | reverse %}

{% if pubs and pubs.size > 0 %}
<section class="project-publications">
  <h2>Related publications</h2>
  <ol class="pub-list">
    {% for pub in pubs %}
      <li class="pub-item">
        <a href="{{ pub.url | relative_url }}">{{ pub.title }}</a>
        {% if pub.collection == 'publications' and pub.venue %}
          <span class="pub-venue"> â€” {{ pub.venue }}</span>
        {% endif %}
        {% if pub.date %}
          <span class="pub-year"> ({{ pub.date | date: '%Y' }})</span>
        {% endif %}
        {% if pub.authors %}
          <div class="pub-authors">{{ pub.authors }}</div>
        {% endif %}
      </li>
    {% endfor %}
  </ol>
</section>
{% elsif pdata.related_publications and pdata.related_publications.size > 0 %}
<section class="project-publications">
  <h2>Related publications</h2>
  <ul class="pub-list">
    {% for item in pdata.related_publications %}
      <li class="pub-item">
        {{ item | markdownify | strip_newlines | replace: '<p>', '' | replace: '</p>', '' }}
      </li>
    {% endfor %}
  </ul>
</section>
{% endif %}
